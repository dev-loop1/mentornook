document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("filter-form"),t=document.getElementById("user-list-container"),n=document.getElementById("loading-message"),s=document.getElementById("no-results-message"),r=document.getElementById("pagination-controls"),l=document.getElementById("search-form"),a=document.getElementById("search-input");let i={role:"",skills:"",interests:"",search:""},o=1;const d=document.getElementById("filter-skills-container"),c=document.getElementById("filter-interests-container");async function u(e={},l=1){if(!t||!n||!s)return void console.error("Cannot display users: Missing required list or message elements.");n.style.display="block",s.style.display="none",t.innerHTML="",r&&(r.innerHTML="");const a=new URLSearchParams;e.role&&a.append("role",e.role),e.skills&&a.append("skills",e.skills),e.interests&&a.append("interests",e.interests),e.search&&a.append("search",e.search),l>1&&a.append("page",l);const i=a.toString(),o=i?`/users/?${i}`:"/users/";try{const e=!0,n=await WorkspaceApi(o,"GET",null,e);if(n.success&&n.data&&Array.isArray(n.data.results)){const e=n.data.results;if(e.length>0){e.forEach((e=>{if(e&&e.user){const n=function(e){const t=document.createElement("div");t.className="user-card";const n="assets/images/profile_avatar_default.png",s=e.name||e.user?.username||"Unnamed User",r=e.role||"",l=e.skills_list||[],a=l.length>0?l.join(", "):"No skills listed",i=e.interests_list||[],o=i.length>0?i.join(", "):"No interests listed",d=e.user?.id,c=d?`<a href="user_profile.html?id=${d}" class="btn btn-secondary btn-sm">View Profile</a>`:"";return t.innerHTML=`\n            <img src="${n}" alt="${s}'s profile picture">\n            <h3>${s}</h3>\n            ${r?`<span class="user-role ${r}">${r}</span>`:""}\n            <p class="user-skills" title="${a}">Skills: ${a}</p>\n            <p class="user-interests" title="${o}">Interests: ${o}</p>\n            ${c}\n        `,t}(e);t.appendChild(n)}else console.warn("Received invalid user profile data item:",e)}));!function(e,t){if(!r||e<=1)return void(r&&(r.innerHTML=""));r.innerHTML="";const n=document.createElement("button");n.textContent="« Prev",n.dataset.page=t-1,n.disabled=1===t,r.appendChild(n);const s=5;let l=Math.max(1,t-Math.floor(s/2)),a=Math.min(e,l+s-1);if(l=Math.max(1,a-s+1),l>1){const e=document.createElement("button");if(e.textContent="1",e.dataset.page=1,r.appendChild(e),l>2){const e=document.createElement("span");e.textContent="...",r.appendChild(e)}}for(let e=l;e<=a;e++){const n=document.createElement("button");n.textContent=e,n.dataset.page=e,e===t&&(n.disabled=!0,n.classList.add("current-page")),r.appendChild(n)}if(a<e){if(a<e-1){const e=document.createElement("span");e.textContent="...",r.appendChild(e)}const t=document.createElement("button");t.textContent=e,t.dataset.page=e,r.appendChild(t)}const i=document.createElement("button");i.textContent="Next »",i.dataset.page=t+1,i.disabled=t===e,r.appendChild(i)}(Math.ceil(n.data.count/10),l)}else s.style.display="block"}else s.textContent=n.error||"Failed to load users.",s.style.display="block",console.error("Error loading users:",n.error)}catch(e){console.error("Error fetching users:",e),s.textContent=e.message||"An unexpected error occurred while fetching users.",s.style.display="block"}finally{n.style.display="none"}}d?initializeTagInput("filter-skills-container","filter-skills-input","filter-skills-tags","filter-skills"):console.warn("Skills filter tag input container not found."),c?initializeTagInput("filter-interests-container","filter-interests-input","filter-interests-tags","filter-interests"):console.warn("Interests filter tag input container not found."),u(i,o),l?l.addEventListener("submit",(e=>{e.preventDefault(),i.search=a.value.trim(),o=1,u(i,o)})):console.warn("Search form not found."),e?e.addEventListener("submit",(e=>{e.preventDefault(),i.role=document.getElementById("filter-role")?.value||"",i.skills=document.getElementById("filter-skills")?.value||"",i.interests=document.getElementById("filter-interests")?.value||"",i.search=a?.value.trim()||"",o=1,u(i,o)})):console.warn("Filter form not found."),r?r.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName&&e.target.dataset.page){const t=parseInt(e.target.dataset.page,10);isNaN(t)||(o=t,u(i,o))}})):console.warn("Pagination controls container not found.")}));